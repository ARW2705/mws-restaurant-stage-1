"use strict";var map,_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},restaurant=void 0;window.initMap=function(){fetchRestaurantFromURL(function(e,t){e?console.error(e):(self.map=new google.maps.Map(document.getElementById("map"),{zoom:16,center:t.latlng,scrollwheel:!1}),fillBreadcrumb(),DBHelper.mapMarkerForRestaurant(self.restaurant,self.map))})},window.fetchRestaurantFromURL=function(r){if(self.restaurant)r(null,self.restaurant);else{var t=getParameterByName("id");if(t)DBHelper.fetchRestaurantById(t,function(e,n){(self.restaurant=n)?DBHelper.getReviewsByRestaurantId(t,function(e,t){(self.reviews=t)?(fillRestaurantHTML(),r(null,n)):console.error(e)}):console.error(e)});else{r("No restaurant id in URL",null)}}},window.fillRestaurantHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant;document.getElementById("restaurant-name").innerHTML=e.name;var t=document.getElementById("restaurant-address"),n=e.address.indexOf(",")+1,r=[e.address.slice(0,n),"<br>",e.address.slice(n)].join("");t.innerHTML=r;var a=document.getElementById("restaurant-img"),i=document.getElementById("picture-source"),d=document.getElementById("picture-img");a.className="restaurant-img";var l=DBHelper.imageUrlForRestaurant(e).substring(4);i.srcset="img/sizes/sm-"+l+".webp 360w,\n                  img/sizes/md-"+l+".webp 480w,\n                  img/sizes/lg-"+l+".webp 800w,\n                  img/sizes/lg-"+l+".webp 2x",d.alt=""+e.name,d.srcset="img/sizes/sm-"+l+".jpg 360w,\n                  img/sizes/md-"+l+".jpg 480w,\n                  img/sizes/lg-"+l+".jpg 800w,\n                  img/sizes/lg-"+l+".jpg 2x",document.getElementById("restaurant-cuisine").innerHTML=e.cuisine_type,e.operating_hours&&fillRestaurantHoursHTML(),fillReviewsHTML()},window.fillRestaurantHoursHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant.operating_hours,t=document.getElementById("restaurant-hours");for(var n in e){var r=document.createElement("tr"),a=document.createElement("td");a.innerHTML=n,a.setAttribute("valign","top"),r.appendChild(a);var i=document.createElement("td"),d=e[n],l=d.indexOf(",")+1;if(0<l){var o=[d.slice(0,l),"<br>",d.slice(l)].join("");i.innerHTML=o}else i.innerHTML=e[n];r.appendChild(i),t.appendChild(r)}},window.fillReviewsHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.reviews,t=document.getElementById("reviews-container"),n=document.createElement("h3");if(n.innerHTML="Reviews",t.appendChild(n),e){var r=document.getElementById("reviews-list");e.forEach(function(e){r.appendChild(createReviewHTML(e))}),t.appendChild(r)}else{var a=document.createElement("p");a.innerHTML="No reviews yet!",t.appendChild(a)}createReviewForm()},window.createReviewForm=function(){var e=document.getElementById("reviews-container"),t=document.createElement("div");t.className="review-form-container";var n=document.createElement("form");n.id="review-form",n.name="review-form",n.setAttribute("data-db-id","-1");var r=document.createElement("h4");r.innerHTML="Submit a Review",r.id="review-input-title",t.appendChild(r);var a=document.createElement("div");a.className="review-name-container";var i=document.createElement("label");i.for="reviewer-name",i.innerHTML="Your name",a.appendChild(i);var d=document.createElement("input");d.type="text",d.name="reviewer-name",d.id="reviewer-name",d.placeholder="Enter your name here",d.addEventListener("change",function(e){e.preventDefault(),checkFormValidation()}),a.appendChild(d),n.appendChild(a);var l=document.createElement("div");l.className="review-rating-slider-container";var o=document.createElement("label");o.for="rating-slider",o.innerHTML="Your rating ",o.id="rating-slider-label";var m=document.createElement("span");m.innerHTML="★★★★★",m.id="slider-value",o.appendChild(m),l.appendChild(o);var c=document.createElement("input");c.type="range",c.min=1,c.max=5,c.value=5,c.step=1,c.name="rating",c.id="rating",c.addEventListener("change",function(e){e.preventDefault(),document.getElementById("slider-value").innerHTML="★".repeat(e.target.value)}),l.appendChild(c),n.appendChild(l);var u=document.createElement("div");u.className="review-body-container";var s=document.createElement("label");s.innerHTML="Comments",s.for="review-body",u.appendChild(s);var v=document.createElement("textarea");v.name="comments",v.id="review-body",v.placeholder="Enter your comments here",v.addEventListener("change",function(e){e.preventDefault(),checkFormValidation()}),u.appendChild(v),n.appendChild(u);var p=document.createElement("div");p.className="review-buttons-container";var w=document.createElement("button");w.innerHTML="Remove",w.id="review-delete-button",w.addEventListener("click",function(e){e.preventDefault(),console.log("deleting review for",e.target)}),p.appendChild(w);var g=document.createElement("button");g.innerHTML="Submit",g.id="review-submit-button",g.disabled=!0,g.addEventListener("click",function(e){e.preventDefault(),console.log("Submitting review"),handleReviewSubmission()}),p.appendChild(g),n.appendChild(p),t.appendChild(n),e.appendChild(t)},window.populateReviewForm=function(e){document.getElementById("review-input-title").innerHTML="Edit your Review";var t=document.getElementById("review-form"),n=e.getAttribute("data-db-id"),r=e.getElementsByTagName("p"),a=r[0].innerHTML,i=r[1].innerHTML.match(/[★]/g).length,d=e.getElementsByTagName("article")[0].innerHTML;t["reviewer-name"].value=a,t.rating.value=i,t["review-body"].value=d,document.getElementById("slider-value").innerHTML="★".repeat(i),t.setAttribute("data-db-id",n),document.getElementById("review-submit-button").innerHTML="Edit",document.getElementById("review-delete-button").style.display="inline-block",checkFormValidation()},window.checkFormValidation=function(){var e=document.getElementById("review-form"),t=e["reviewer-name"].value,n=e["review-body"].value;document.getElementById("review-submit-button").disabled=!t||!n},window.handleReviewSubmission=function(){var e=document.getElementById("review-form"),t=e.getAttribute("data-db-id"),n=e["reviewer-name"].value,r=parseInt(e.rating.value),a=e["review-body"].value,i={restaurant_id:self.restaurant.id,name:n,rating:r,comments:a};-1!=t?DBHelper.updateReview(t,i).then(function(e){e?(console.log("Review successfully updated"),updateReviewHTML(0,e)):console.log("Error updating review")}):DBHelper.addNewReview(i).then(function(e){e?(console.log("Review successfully added",e),self.reviews.push(e),updateReviewHTML(1,e)):console.log("Error creating new review")});resetReviewForm()},window.removeReview=function(e){},window.updateReviewHTML=function(e,t){var n=document.getElementById("reviews-list");switch(e){case-1:break;case 0:console.log("Updating review list");for(var r=0;r<n.children.length;r++){var a=n.children[r];if(a.getAttribute("data-db-id")==t.id){var i=a.getElementsByTagName("p");i[0].innerHTML=t.name,i[1].innerHTML="Rating: "+"★".repeat(t.rating),a.getElementsByTagName("article")[0].innerHTML=t.comments,a.getElementsByTagName("time")[0].innerHTML=getFormattedTimestamp(t.updatedAt);break}}break;case 1:console.log("Appending to review list"),n.appendChild(createReviewHTML(t))}},window.resetReviewForm=function(){document.getElementById("review-input-title").innerHTML="Submit a Review",document.getElementById("review-form").reset()},window.createReviewHTML=function(e){var t=document.createElement("li");t.setAttribute("data-db-id",e.id);var n=document.createElement("div");n.className="review-card-header";var r=document.createElement("div");r.className="review-card-body";var a=document.createElement("p");a.innerHTML=e.name,n.appendChild(a);var i=document.createElement("time");i.innerHTML=getFormattedTimestamp(e.updatedAt),n.appendChild(i),t.appendChild(n);var d=document.createElement("p");d.innerHTML="Rating: "+"★".repeat(e.rating),r.appendChild(d);var l=document.createElement("a");l.innerHTML="✎",l.id="review-edit-button",l.href="#review-form",l.addEventListener("click",function(e){var t=e.target.closest("li");populateReviewForm(t)}),r.appendChild(l);var o=document.createElement("article");return o.innerHTML=e.comments,r.appendChild(o),t.appendChild(r),t},window.getFormattedTimestamp=function(e){console.log(e),console.log(void 0===e?"undefined":_typeof(e));var t=new Date(e);console.log(t);var n=t.getDate(),r=t.getMonth(),a=t.getFullYear();return["Jan","Feb","Mar","Apr","May","June","July","Aug","Sep","Oct","Nov","Dec"][r]+" "+n+", "+a},window.fillBreadcrumb=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant,t=document.getElementById("breadcrumb");t.lastElementChild.removeAttribute("aria-current");var n=document.createElement("li");n.innerHTML=e.name,n.setAttribute("aria-current","page"),t.appendChild(n)},window.getParameterByName=function(e,t){t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var n=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null};